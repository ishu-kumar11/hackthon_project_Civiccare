{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/track_issue.css' %}">

<section class="track-page">

  <div class="track-card">

    <h2>ğŸ” {% trans "Track Your Issue" %}</h2>

    <!-- SEARCH FORM -->
    <form method="POST" class="track-form">
      {% csrf_token %}
      <input
        type="text"
        name="complaint_id"
        class="track-input"
        placeholder="{% trans 'Enter Complaint ID (e.g. CC-2025-0001)' %}"
        required
      />

      <button type="submit" class="track-btn">
        {% trans "Track Issue" %}
      </button>
    </form>

    <!-- ERROR MESSAGE -->
    {% if error %}
  <p class="track-error">{{ error }}</p>
{% endif %}

        <!-- ISSUE DETAILS -->
    {% if issue %}
      <div class="track-details">
        <hr>

        <h3>ğŸ“„ {% trans "Issue Details" %}</h3>

        <p>
          <strong>{% trans "Complaint ID:" %}</strong>
          {{ issue.complaint_id }}
        </p>

        <p>
          <strong>{% trans "Status:" %}</strong>
          <span class="status status-{{ issue.status }}">
            {{ issue.get_status_display }}
          </span>
        </p>

        {% if issue.status == "reopened" %}
          <p style="color:red; font-weight:600; margin-top:10px;">
            â— {% trans "This issue was reopened because citizens reported it is not solved." %}
          </p>
        {% endif %}

        <p>
          <strong>{% trans "Category:" %}</strong>
          {{ issue.get_category_display }}
        </p>

        <p>
          <strong>{% trans "Urgency:" %}</strong>
          {{ issue.get_urgency_display }}
        </p>

        <p>
          <strong>{% trans "State:" %}</strong>
          {{ issue.get_state_display }}
        </p>

        <p>
          <strong>{% trans "District:" %}</strong>
          {{ issue.district }}
        </p>

        <p>
          <strong>{% trans "Area / Locality:" %}</strong>
          {{ issue.location }}
        </p>

        <p>
          <strong>{% trans "Pincode:" %}</strong>
          {{ issue.pincode }}
        </p>

        <p>
          <strong>{% trans "Reported On:" %}</strong>
          {{ issue.created_at|date:"d M Y" }}
        </p>

        <p>
          <strong>{% trans "Description:" %}</strong><br>
          {{ issue.description }}
        </p>

        <!-- âœ… RESOLUTION CONFIRMATION SECTION -->
        {% if user.is_authenticated and issue.status == "resolved" %}
          <hr>
          <h3>âœ… {% trans "Resolution Confirmation" %}</h3>

          <p style="margin-bottom: 10px;">
            {% trans "Was this issue actually solved?" %}
          </p>

          <div class="resolution-actions">
            <a href="{% url 'confirm_issue_solved' issue.id %}" class="btn-confirm">
              âœ… {% trans "Confirm Solved" %}
            </a>

            <a href="{% url 'report_issue_not_solved' issue.id %}" class="btn-reopen">
              âŒ {% trans "Not Solved (Reopen)" %}
            </a>
          </div>
        {% endif %}

      </div>
    {% endif %}

  </div>
</section>

{% endblock %}

